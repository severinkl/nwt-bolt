# HTTP Level 3 Scenario - DNS Resolution with ARP and Firewall
# Format: step;device;image(opt);wled(opt);time_sec(default=5);desc(opt);

1;main;000_init.png;;;;
2;main;001_TypeURL@Client.png;;;;
3;main;002_DNScache@Client.png;;;;
4;main;003_DNSquery@Client.png;;;;
5;main;004_DNSquery@Client.png;main>switch;;
6;switch;005_DNSqueryPacket@Switch.png;;;Der Switch empfängt die DNS-Anfrage und muss sie weiterleiten.;
7;switch;006_ARP@switch.png;;;Der Switch erkennt, dass das Paket für die IP-Adresse 192.168.0.1 bestimmt ist.;
8;switch;007_ARP@switch.png;;;Dafür benötigt er die passende MAC-Adresse und startet eine ARP-Anfrage.;
9;switch;008_ARPBroadcast@switch.png;;;Der Switch sendet ein Broadcast, um die MAC-Adresse von 192.168.0.1 herauszufinden.;
10;switch;;switch>main;;
10;switch;;switch>router;;
11;main;010_ARPBroadcast@transfer.png;;;;
12;router;010_ARPBroadcast@transfer.png;;;Dieses ARP-Broadcast erreicht alle Geräte im lokalen Netz.;
12;router;011_ARPReply@router.png;router>switch;;Der Router meldet sich mit seiner ARP-Antwort: Er besitzt die IP-Adresse 192.168.0.1 und gibt seine MAC-Adresse bekannt.;
13;switch;012_ARPdone@switch.png;switch>router;;Der Switch kennt nun die Zuordnung von IP zu MAC-Adresse.;
14;router;013_DNSqueryPacket@Router.png;;;Mit dieser Information kann das DNS-Paket an den Router weitergeleitet werden.;
15;router;014_Routelookup@router.png;;;Der Router prüft, wohin er die DNS-Anfrage schicken muss.;
16;router;015_Routelookup@router.png;router>dns;;Das Ziel wurde gefunden, die Weiterleitung wird vorbereitet.;
17;dns;016_DNSqueryPacket@DNS.png;;;Das Paket erreicht den zuständigen DNS-Server.;
18;dns;017_DNSquery@DNS.png;;;Der DNS-Server verarbeitet die Anfrage und sucht die IP-Adresse.;
19;dns;018_DNSreply@DNS.png;dns>router;;Der DNS-Server erstellt eine Antwort mit der passenden IP-Adresse.;
20;router;019_DNSreply@router.png;;;Der Router empfängt die DNS-Antwort und bereitet die Weiterleitung vor.;
21;router;020_Routelookup@router.png;;;Der Router sucht die richtige Route zurück zum Client.;
22;router;021_Routelookup@router.png;router>switch;;Er hat die Route gefunden und sendet die Antwort ins Netzwerk zurück.;
23;switch;022_DNSreply@switch.png;;;Der Switch empfängt die DNS-Antwort.;
24;switch;023_ARP@switch.png;;;Um das Zielgerät zu erreichen, benötigt er erneut die MAC-Adresse.;
25;switch;024_ARP@switch.png;switch>main;;Der Switch kennt die MAC-Adresse des Clients bereits aus seiner ARP-Tabelle. Er weiß, dass der Client am Interface IF-01 angeschlossen ist und kann das Paket gezielt zustellen.;
26;main;025_DNSreply@client.png;;;;
27;main;026_DNSreply@client.png;;;;
28;main;027_DNSok@client.png;;;;
30;main;030_TCP_SYN@Client.png;main>switch;;
31;switch;031_TCP_SYN@Transfer.png;switch>router;;Das SYN-Paket durchläuft das Netzwerk und wird weitergeleitet.;
32;router;031_TCP_SYN@Transfer.png;router>firewall;;Das SYN-Paket durchläuft das Netzwerk und wird weitergeleitet.;
33;firewall;031_TCP_SYN@Transfer.png;;;Das SYN-Paket durchläuft das Netzwerk und wird weitergeleitet.;
34;firewall;032_ACL@firewall.png;;;Die Firewall prüft anhand von ACL-Regeln, ob die Verbindung erlaubt ist.;
35;firewall;033_ACL@firewall.png;;;Die Anfrage ist erlaubt und darf weiter.;
36;firewall;034_NAT@firewall.png;;;Die Firewall überprüft, ob für den ausgehenden Datenverkehr eine NAT aktiv ist. Nur so kann die private IP-Adresse des Clients das Internet nutzen.;
37;firewall;035_NAT@firewall.png;firewall>server;;Die Firewall bestätigt: NAT ist aktiviert. Die Quelladresse des Clients wird maskiert – er tritt nach außen mit der Adresse 192.168.0.100 auf.;
38;server;038_TCP_SYN@Server.png;;;Der Server empfängt das SYN-Paket.;
39;server;039_TCP_SYNACK@Server.png;server>firewall;;Der Server antwortet mit SYN/ACK, um die Verbindung zu bestätigen.;
40;firewall;040_TCP_SYNACK@Transfer.png;;;Das SYN/ACK-Paket tritt den Rückweg zum Client an.;
41;firewall;041_ACL@firewall.png;;;Die Firewall prüft erneut, ob diese Antwort erlaubt ist.;
42;firewall;042_ACL@firewall.png;;;Das Paket wird erlaubt: Es gehört zu einem bestehenden Verbindungsaufbau (Stateful Traffic).;
43;firewall;043_NAT@firewall.png;firewall>router;;Die Firewall übersetzt die Zieladresse zurück (SNAT).;
44;router;040_TCP_SYNACK@Transfer.png;router>switch;;Das SYN/ACK-Paket tritt den Rückweg zum Client an.;
45;switch;040_TCP_SYNACK@Transfer.png;switch>main;;Das SYN/ACK-Paket tritt den Rückweg zum Client an.;
46;main;045_TCP_SYNACK@Client.png;;;Der Client erhält die SYN/ACK-Antwort des Servers;
47;main;046_TCP_ACK@Client.png;main>switch;;Der Client bestätigt mit einem ACK das Zustandekommen der Verbindung.;
48;switch;047_TCP_ACK@Transfer.png;switch>router;;Das ACK-Paket wird über Switch übertragen;
49;router;047_TCP_ACK@Transfer.png;router>firewall;;Das ACK-Paket wird über Router übertragen;
50;firewall;047_TCP_ACK@Transfer.png;firewall>server;;Das ACK-Paket wird über Router übertragen;
51;server;051_TCP_ACK@Server.png;;;Der Server empfängt die Bestätigung (ACK).;
52;main;052_TCP_established@Client.png;;;TEAM: wär geil, wenn wir hier das LED durchgehend kurz beleuchten könnten;
52;server;052_TCP_established@Server.png;;;TEAM: wär geil, wenn wir hier das LED durchgehend kurz beleuchten könnten;
60;main;060_TLS_Clienthello@Client.png;main>switch;;Der Client startet die verschlüsselte Verbindung mit einem „ClientHello".;
61;switch;061_TLS_Clienthello@Transfer.png;switch>router;;Die TLS-Anfrage wird durch das Netzwerk weitergeleitet.;
62;router;061_TLS_Clienthello@Transfer.png;router>firewall;;Die TLS-Anfrage wird durch das Netzwerk weitergeleitet.;
63;firewall;061_TLS_Clienthello@Transfer.png;firewall>server;;Die TLS-Anfrage wird durch das Netzwerk weitergeleitet.;
64;server;064_TLS_Clienthello@Server.png;;;Der Server empfängt das „ClientHello".;
65;server;065_TLS_Serverhello@Server.png;;;Der Server antwortet mit einem „ServerHello".;
66;server;066_TLS_ServerCertificate@Server.png;server>firewall;;Der Server sendet sein digitales Zertifikat.;
67;firewall;067_TLS_ServerhelloCert@Transfer.png;firewall>router;;Das Zertifikat wird an den Client weitergereicht.;
68;router;067_TLS_ServerhelloCert@Transfer.png;router>switch;;Das Zertifikat wird an den Client weitergereicht.;
69;switch;067_TLS_ServerhelloCert@Transfer.png;switch>main;;Das Zertifikat wird an den Client weitergereicht.;
70;main;067_TLS_ServerhelloCert@Transfer.png;;;Das Zertifikat wird an den Client weitergereicht.;
71;main;071_TLS_Certcheck@Client.png;;;Der Client prüft die Echtheit und Gültigkeit des Zertifikats.;
72;main;072_TLS_Keyderivation@Client.png;;;Der Client erzeugt Schlüsselmaterial für die Verschlüsselung.;
72;server;072_TLS_Keyderivation@Server.png;;;Auch der Server erstellt den gemeinsamen Sitzungsschlüssel.;
73;main;073_TLS_Finish@Client.png;;;TEAM: wär geil, wenn wir hier das LED durchgehend kurz beleuchten könnten;
73;server;073_TLS_Finish@Server.png;;;TEAM: wär geil, wenn wir hier das LED durchgehend kurz beleuchten könnten;
80;main;080_HTTPget@Client.png;main>switch;;Ein Datenpaket mit einer Anfrage nach einer Webseite wurde vom Gerät erstellt. Dieses Paket wird jetzt an den Internetrouter (Gateway) gesendet.;
81;switch;081_HTTPget@Transfer.png;switch>router;;Das Datenpaket erreicht nun den Netzwerk-Switch. Dieser ist nicht das Gateway, daher leitet er es weiter zum Gateway.;
82;router;081_HTTPget@Transfer.png;router>firewall;;Paket durchläuft den Router. Dieser kennt die Route ins Internet und übermittelt es an die Firewall.;
83;firewall;081_HTTPget@Transfer.png;firewall>server;;Die Firewall ist der Übergang ins Internet. Sie überprüft, ob die Kommunikation erlaubt ist und überprüft ebenfalls auf schädliche Inhalte.;
84;server;084_HTTPget@Server.png;;;Die HTTP GET-Anfrage erreicht nun den Webserver und wird verarbeitet.;
85;server;085_QueryPage@WebserverORF.png;;;Der Webserver durchsucht die Datenbank und führt eine Abfrage für /index.html aus.;
86;server;086_FoundPage@WebserverORF.png;;;Der Webserver hat den Inhalt gefunden und bereitet ihn als Webseite vor.;
87;server;087_DeliverHTTPokWithContent@WebserverORF.png;server>firewall;;Das HTTP OK wird nun übermittelt und inkludiert den Content der Website.;
88;firewall;088_HTTPok@Transfer.png;firewall>router;;Das Paket trifft nun wieder bei der Firewall ein und wird überprüft.;
89;router;088_HTTPok@Transfer.png;;;Die Firewall hat das Paket an den Router übermittelt, welcher die Route retour zum Client kennt.;
90;router;089_Enrypted@Router.png;router>switch;;Zur Demonstration: Der Netzwerkverkehr ist VERSCHLÜSSELT. Ein Router, bzw. andere Parteien die mitlauschen, können den Traffic nicht interpretieren!;
91;switch;088_HTTPok@Transfer.png;switch>main;;Der Switch kennt die lokale MAC-Adresse des Clients und weiß, an welchem Port dieser anliegt. Er leitet das Paket einfach weiter.;
92;main;091_HTTPok@Client.png;switch>main;;Das Paket erreicht nun den Client. Die Webseite kann nun geladen und angezeigt werden.;
94;main;093_HTMLCode@Client.png;;;Der HTML-Code wird nun vom Browser interpretiert und die Webseite dargestellt.;
95;main;094_Website@Client.png;;;Das Ergebnis ist eine vollständig geladene Webseite welche dem Nutzer nun im Browser angezeigt wird.;
100;main;999_finish.png;;;;